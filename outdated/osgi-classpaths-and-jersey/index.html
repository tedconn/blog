<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title></title>
    <link rel="stylesheet" href="https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog/css/font-comic-neue.css" />
    <link rel="stylesheet" href="https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog/darkmode.css" />
    <link rel="stylesheet" href="https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog/lightmode.css" />
    <link rel="stylesheet" href="https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog/fontawesome-free-5.15.2-web/css/all.min.css" />
    <link rel="stylesheet" href="https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog/fontawesome-free-5.15.2-web/css/brands.min.css" />
    <script src="https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog&#x2F;js&#x2F;navbar.js"></script>
    <!-- <script src="https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog&#x2F;js&#x2F;navbar.js"
        integrity="sha384-6ea11b2a27dbdb3031babafee75b24601c5d9a7800002d6ab8fd4d9736986d2c73624253573f37723129feb00152985b"></script> -->
</head>

<body class="">
    <nav class="navbar is-spaced" role="navigation" aria-label="main navigation">
        <div class="container is-max-desktop">
            <div class="navbar-brand">
                <a class="navbar-item has-text-weight-bold is-family-monospace" href="https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog">
                    let blueJEKYLL=benjaminFRY;
                </a>
                <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false"
                    data-target="navbar-data">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>

            <div id="navbar-data" class="navbar-menu">
                <div class="navbar-end">
                    <a class="navbar-item" href="https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog/posts">
                        <span class="icon-text">
                            <span class="icon">
                                <i class="fas fa-th-list"></i>
                            </span>
                            <span>Posts</span>
                        </span>
                    </a>
                    <a class="navbar-item" href="https:&#x2F;&#x2F;github.com&#x2F;bluejekyll">
                        <span class="icon-text">
                            <span class="icon">
                                <i class="fab fa-github"></i>
                            </span>
                            <span>Github</span>
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </nav>
    
<section class="hero mb-5">
    <div class="hero-body">
        <div class="container is-max-desktop">
            <p class="title is-2">
                OSGi Classpaths and Jersey
            </p>
            <p class="subtitle is-4 is-italic">
                
            </p>
            <p class="is-family-monospace is-7 has-text-light">2012-04-18</p>
        </div>
    </div>
</section>

<div class="container is-max-desktop box">
    <article class="content">
        <p><p><em>Since writing this, I do not recommend OSGi any more, just use <a href="http://www.dropwizard.io">DropWizard</a></em></p>
<p>OSGi is cool, but it adds a ton of classpath constraints. I'll put up a complete OSGi page about some of the headaches I've run into and the basic setup I use at a later date, but today I want to share how to get rid of a ClassNotFoundException when trying to deploy Jersey.</p>
<p>If you're not familiar with Jersey it's an implementation from Sun/Oracle of the JAX-RS spec. Basically an annotation system in java for deploying rest based web services.</p>
<p>Anyway, this post isn't about that, it's about this:</p>
<pre style="background-color:#2b303b;">
<code><span style="color:#c0c5ce;">java.lang.ClassNotFoundException: com.sun.jersey.spi.container.servlet.ServletContainer
 at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:513)
 at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:429)
 at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:417)
 at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:107)
 at java.lang.ClassLoader.loadClass(ClassLoader.java:248)
 at org.eclipse.jetty.webapp.WebAppClassLoader.loadClass(WebAppClassLoader.java:424)
 ...
 at org.eclipse.jetty.osgi.boot.OSGiAppProvider.addContext(OSGiAppProvider.java:232)
 at org.eclipse.jetty.osgi.boot.OSGiAppProvider.addContext(OSGiAppProvider.java:214)
 ...
 at org.osgi.util.tracker.BundleTracker$Tracked.customizerAdding(BundleTracker.java:439)
 at org.osgi.util.tracker.AbstractTracked.trackAdding(AbstractTracked.java:261)
 at org.osgi.util.tracker.AbstractTracked.trackInitial(AbstractTracked.java:184)
 at org.osgi.util.tracker.BundleTracker.open(BundleTracker.java:159)
 at org.eclipse.jetty.osgi.boot.JettyBootstrapActivator.start(JettyBootstrapActivator.java:118)
 at org.eclipse.osgi.framework.internal.core.BundleContextImpl$1.run(BundleContextImpl.java:711)
 at java.security.AccessController.doPrivileged(Native Method)
 at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:702)
 at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:683)
 at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:381)
 at org.eclipse.osgi.framework.internal.core.AbstractBundle.start(AbstractBundle.java:299)
 at org.eclipse.osgi.framework.internal.core.AbstractBundle.start(AbstractBundle.java:291)
</span></code></pre>
<p>I'd been beating my head into the wall all morning when the problem/solution struck me. I'd doubled checked that I had these bundles installed and started (maven dependencies):</p>
<pre style="background-color:#2b303b;">
<code class="language-xml" data-lang="xml"><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;com.sun.jersey&lt;/</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;jersey-core&lt;/</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">version</span><span style="color:#c0c5ce;">&gt;1.12&lt;/</span><span style="color:#bf616a;">version</span><span style="color:#c0c5ce;">&gt;
&lt;/</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
&lt;</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;com.sun.jersey&lt;/</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;jersey-server&lt;/</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">version</span><span style="color:#c0c5ce;">&gt;1.12&lt;/</span><span style="color:#bf616a;">version</span><span style="color:#c0c5ce;">&gt;
&lt;/</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
&lt;</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;com.sun.jersey&lt;/</span><span style="color:#bf616a;">groupId</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;jersey-servlet&lt;/</span><span style="color:#bf616a;">artifactId</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">version</span><span style="color:#c0c5ce;">&gt;1.12&lt;/</span><span style="color:#bf616a;">version</span><span style="color:#c0c5ce;">&gt;
&lt;/</span><span style="color:#bf616a;">dependency</span><span style="color:#c0c5ce;">&gt;
</span></code></pre>
<p>They were right there in the OSGi runtime: &quot;Active&quot;. So what was up? The answer lies in how I was referencing the Jersey context in my web.xml:</p>
<pre style="background-color:#2b303b;">
<code class="language-xml" data-lang="xml"><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">servlet</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">servlet-name</span><span style="color:#c0c5ce;">&gt;com.sun.jersey.spi.container.servlet.ServletContainer&lt;/</span><span style="color:#bf616a;">servlet-name</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">servlet-class</span><span style="color:#c0c5ce;">&gt;com.sun.jersey.spi.container.servlet.ServletContainer&lt;/</span><span style="color:#bf616a;">servlet-class</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">init-param</span><span style="color:#c0c5ce;">&gt;
    &lt;</span><span style="color:#bf616a;">param-name</span><span style="color:#c0c5ce;">&gt;javax.ws.rs.Application&lt;/</span><span style="color:#bf616a;">param-name</span><span style="color:#c0c5ce;">&gt;
    &lt;</span><span style="color:#bf616a;">param-value</span><span style="color:#c0c5ce;">&gt;com.my.Application&lt;/</span><span style="color:#bf616a;">param-value</span><span style="color:#c0c5ce;">&gt;
  &lt;/</span><span style="color:#bf616a;">init-param</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">load-on-startup</span><span style="color:#c0c5ce;">&gt;1&lt;/</span><span style="color:#bf616a;">load-on-startup</span><span style="color:#c0c5ce;">&gt;
&lt;/</span><span style="color:#bf616a;">servlet</span><span style="color:#c0c5ce;">&gt;
&lt;</span><span style="color:#bf616a;">servlet-mapping</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">servlet-name</span><span style="color:#c0c5ce;">&gt;com.sun.jersey.spi.container.servlet.ServletContainer&lt;/</span><span style="color:#bf616a;">servlet-name</span><span style="color:#c0c5ce;">&gt;
  &lt;</span><span style="color:#bf616a;">url-pattern</span><span style="color:#c0c5ce;">&gt;/*&lt;/</span><span style="color:#bf616a;">url-pattern</span><span style="color:#c0c5ce;">&gt;
&lt;/</span><span style="color:#bf616a;">servlet-mapping</span><span style="color:#c0c5ce;">&gt;
</span></code></pre>
<p>It turns out this is the only reference to the ServletContainer anywhere in my &quot;code&quot;, in the web.xml. I use the maven-bundle-plugin for generating the bundles. The Bnd tool at the core of that plugin automatically collects all the Import-Packages from what's being imported in your Java code.</p>
<p>The classpath in OSGi is partly derived from your Import-Package statement, and since nowhere in my code was I explicitly referencing the ServletContainer, that class was never made available on the classpath.</p>
<p>Solution, changed the configuration of the maven-bundle-plugin to add the package to the Import-Package statement:</p>
<pre style="background-color:#2b303b;">
<code class="language-xml" data-lang="xml"><span style="color:#c0c5ce;">&lt;</span><span style="color:#bf616a;">Import-Package</span><span style="color:#c0c5ce;">&gt;com.sun.jersey.spi.container.servlet,*&lt;/</span><span style="color:#bf616a;">Import-Package</span><span style="color:#c0c5ce;">&gt;
</span></code></pre>
<p>And then Jersey was deployed, and the world was calm.</p>
</p>
    </article>
    <section class="section">
        <div>
            <a href="https://twitter.com/intent/tweet?text=OSGi Classpaths and Jersey&url=https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog&#x2F;outdated&#x2F;osgi-classpaths-and-jersey&#x2F;&via=https:&#x2F;&#x2F;twitter.com&#x2F;benj_fry&related=https:&#x2F;&#x2F;twitter.com&#x2F;benj_fry"
                rel="nofollow" target="_blank" title="Share on Twitter">
                <span class="icon-text button">
                    <span class="icon">
                        <i class="fab fa-twitter-square"></i>
                    </span>
                    <span>Tweet this</span>
                </span>
            </a>
            <a href="http://www.reddit.com/submit?url=https:&#x2F;&#x2F;bluejekyll.github.io&#x2F;blog&#x2F;outdated&#x2F;osgi-classpaths-and-jersey&#x2F;&title=OSGi Classpaths and Jersey" rel="nofollow"
                target="_blank" title="Discuss on Reddit">
                <span class="icon-text button">
                    <span class="icon">
                        <i class="fab fa-reddit-square"></i>
                    </span>
                    <span>Talk on Reddit</span>
                </span>
            </a>
            <a href="javascript:window.location=%22http://news.ycombinator.com/submitlink?u=%22+encodeURIComponent(document.location)+%22&t=%22+encodeURIComponent(document.title)"
                title="Discuss on Hacker News">
                <span class="icon-text button">
                    <span class="icon">
                        <i class="fab fa-hacker-news-square"></i>
                    </span>
                    <span>Discuss on Hacker News</span>
                </span>
            </a>
        </div>
    </section>
</div>


    <footer class="footer">
        <div class="container is-max-desktop">
            <div class="content  has-text-centered">
                <p class="is-size-7 has-text-dark">A Self-proclaimed Rust evangelist, Java distributed systems engineer, recovering C&#x2F;C++ masochist; Pie and bread maker; Cyclist; Raiser of Humans.</p>
                <h4 class="3sidebar-title text-center">Contact</h4>
                <div>
                    <a class="" href="mailto:benjaminfry@me.com">
                        <span class="icon-text">
                            <span class="icon">
                                <i class="fas fa-paper-plane"></i>
                            </span>
                            <span>benjaminfry@me.com</span>
                        </span>
                    </a>
                </div>
                <div>
                    <a class="" href="https:&#x2F;&#x2F;github.com&#x2F;bluejekyll">
                        <span class="icon-text">
                            <span class="icon">
                                <i class="fab fa-github"></i>
                            </span>
                            <span>Github</span>
                        </span>
                    </a>
                </div>
                <div>
                    <a class="" href="https:&#x2F;&#x2F;twitter.com&#x2F;benj_fry">
                        <span class="icon-text">
                            <span class="icon">
                                <i class="fab fa-twitter"></i>
                            </span>
                            <span>Twitter</span>
                        </span>
                    </a>
                </div>
                <div>
                    <a class="" href="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;benjamin-fry-8b83072&#x2F;">
                        <span class="icon-text">
                            <span class="icon">
                                <i class="fab fa-linkedin"></i>
                            </span>
                            <span>LinkedIn</span>
                        </span>
                    </a>
                </div>
            </div>
        </div>
        </div>
    </footer>
</body>

</html>